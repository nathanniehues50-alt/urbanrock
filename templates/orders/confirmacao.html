{% extends "base.html" %}

{% block title %}Pedido #{{ pedido.id }} - Confirma√ß√£o{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- CABE√áALHO -->
  <div class="mb-4">
    <h1 class="h3 mb-1">Pedido confirmado! üéâ</h1>
    <p class="text-muted mb-0">
      Seu pedido <strong>#{{ pedido.id }}</strong> foi registrado com sucesso.
    </p>
  </div>

  <div class="row g-4">

    <!-- COLUNA ESQUERDA -->
    <div class="col-lg-6">

      <!-- STATUS DO PEDIDO -->
      <div class="card shadow-sm mb-3">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-1">Status atual</h5>
            {% if pedido.status == "pago" %}
              <p class="mb-0 text-success fw-bold">Pago ‚úÖ</p>
            {% elif pedido.status == "aguardando_pagamento" %}
              <p class="mb-0 text-warning fw-bold">Aguardando pagamento</p>
            {% elif pedido.status == "cancelado" %}
              <p class="mb-0 text-danger fw-bold">Cancelado</p>
            {% else %}
              <p class="mb-0 text-muted">{{ pedido.status|capfirst }}</p>
            {% endif %}
          </div>
          <span class="badge rounded-pill bg-primary fs-6">
            R$ {{ pedido.total }}
          </span>
        </div>
      </div>

      <!-- ENDERE√áO DE ENTREGA -->
      {% if pedido.endereco %}
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h5 class="card-title mb-3">Endere√ßo de entrega</h5>
          <p class="mb-0">
            {{ pedido.endereco.logradouro }},
            {{ pedido.endereco.numero }}<br>
            {{ pedido.endereco.bairro }} - {{ pedido.endereco.cidade }}/{{ pedido.endereco.estado }}<br>
            CEP: {{ pedido.endereco.cep }}
          </p>
        </div>
      </div>
      {% endif %}

      <!-- TOTAL DO PEDIDO -->
      <div class="card shadow-sm">
        <div class="card-body d-flex justify-content-between align-items-center">
          <span class="fw-bold">Total do pedido</span>
          <span class="fw-bold fs-5">R$ {{ pedido.total }}</span>
        </div>
      </div>

    </div>

    <!-- COLUNA DIREITA -->
    <div class="col-lg-6">

      <!-- ITENS DO PEDIDO -->
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h5 class="card-title mb-3">Itens do pedido</h5>

          {% if itens %}
            <ul class="list-group list-group-flush">
              {% for item in itens %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <strong>{{ item.produto.nome }}</strong><br>
                    <small class="text-muted">
                      Qtd: {{ item.quantidade }}
                    </small>
                  </div>
                  <div class="text-end">
                    <small class="d-block text-muted">
                      R$ {{ item.preco_unitario }}
                    </small>
                    <span class="fw-bold">
                      R$ {{ item.subtotal }}
                    </span>
                  </div>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">Nenhum item encontrado neste pedido.</p>
          {% endif %}
        </div>
      </div>

      <!-- PAGAMENTO / A√á√ïES -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-3">Pagamento</h5>

          <form method="post" action="{% url 'iniciar_pagamento' %}" class="mb-2">
            {% csrf_token %}
            <input type="hidden" name="pedido_id" value="{{ pedido.id }}">

            {% if pedido.status == "pago" %}
              <button type="submit" class="btn btn-success w-100 btn-lg" disabled>
                Pedido j√° pago ‚úîÔ∏è
              </button>
            {% else %}
              <button type="submit" class="btn btn-primary w-100 btn-lg">
                Ir para o pagamento üí≥
              </button>
            {% endif %}
          </form>

          <a href="{% url 'home' %}" class="btn btn-outline-secondary w-100">
            Voltar para a loja
          </a>
        </div>
      </div>

    </div>
  </div>

</div>
{% endblock %}
